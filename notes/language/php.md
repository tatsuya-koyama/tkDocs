---
title: 'PHP 7'
date: '2016-06-10'
description:
categories: []
tags: [anything, Language, PHP]
position: 1
---

# PHP 備忘録（PHP7 対応）

※ まだ WIP

## 他の言語から来た人向け要約
- セミコロンは要る
- 命令の大文字・小文字を区別しない
    - 変数の大文字・小文字は区別されるから安心しろ
- コメントは `//`, `/* 〜 */` に加え `#` もある
- 変数の宣言は不要
- 変数は `$hoge` みたいに $ つける
    - 予約語と同じ名前でも大丈夫
- 可変変数 `$$x`, `${$x}`
- 定数 `const PI = 3.14;` (PHP5.3)
- 未定義値は `null`

        // null になるシリーズ
        $var1;
        $var2 = null;
        unset($var3);

____

- `++`, `--` はある
    - 後置と前置もある
- 厳密な比較は JavaScript みたいに `===` でやる

## 文字列
- シングルクォートかダブルクォート
- シングルクォートは `\'` と `\\` だけエスケープする
- ダブルクォートは変数展開する

        // $ は括弧の中にあっても外にあってもいい
        "This is $var !"
        "This is {$var} !"
        "This is ${var} !"

____

- ヒアドキュメント

        <<<EOD
        ...
        EOD;

        // ヒアドキュメント内は変数展開される。したくない場合は
        <<<'EOD'
        ...
        EOD;

____

- 文字列の連結は `+` ではなく `.`
    - `+` だと文字列を数値に変換して加算するので気をつけろ

## false とみなすやつ
- 空文字列 `""`, 文字列の `"0"`
- 整数リテラルの `0`
- 浮動小数リテラルの `0.0`
- 要素数 0 の配列
- `null`

## 配列と連想配列

- 内部的にはどちらも連想配列として扱われる
- キーが省略されたら 0 から始まる index が自動的に振られる感じ
- キーには任意のデータ型を指定できるけど、キーに整数 / 文字列以外のものが指定された場合は、
  内部的に整数 / 文字列に変換される
- 配列やオブジェクトはキーにはできない

        $list = [1, 'a', 2];
        $map  = [
            'hoge' => 123,
            'fuga' => 456,
            789    => 'piyo',
        ];

## リファレンス

- & を使う

        $x = 1;
        $x_ref = &$x;
        $x = 2;
        print $x_ref;  // -> 2

____

- オブジェクトは勝手に参照渡しになる
    - オブジェクトに & をつけると PHP5 では警告、PHP7 ではエラー

## 注意点

- `==` 使ったときの数値と文字列の比較がわりとキモい
- 基本的に `===` を使った方がいいだろう

        // '0x10' は 0 とみなされる
        var_dump('0x10' == 16);     // -> bool (false)

        // '010' は 10 とみなされる
        var_dump('010' == 10);      // -> bool (true)

        // 文字列の場合、先頭の数値だけが認識される。
        // 数値が無い場合 0 になるのでこれが true になる
        var_dump('X' == 0);         // -> bool (true)

        var_dump('13xyz' == 13);    // -> bool (true)
        var_dump('13xyz' == '13');  // -> bool (false)

____

- 配列の比較も演算子でできるけど、わりと特殊
- 三項演算子が左結合なのはビビる
- switch は `===` ではなく `==` で比較する
- switch 内での continue は break と同様の挙動
    - continue 書いても switch を抜けるだけで外側の for を continue とかしないので注意


## 小ネタ

- 三項演算子の省略構文がある
    - `$foo = $bar ?: 'default-value';`
- エラー制御演算子
    - @ を式の先頭につけるとその命令で発生するエラーメッセージを抑制する
- 制御命令に別構文がある
- require_once で読み込む
    - スコープを継承する
- global 命令
- static 命令


## 関数

- 関数は後ろに書いてあっても大丈夫
- 関数内関数も外から参照できる。ただしその関数が呼び出された後に
- 引数のデフォルト値はある
- 引数の参照渡しもある
- 可変長引数は PHP 5.6 から
    - それ以前は `func_get_args()` 関数を使う
- `...` 演算子でアンパックできる
    - 引数 2 つある関数を `someFunc(...[1, 2]);` みたいに呼んだりとか
- 複数の戻り値は list 関数で受け取る
    - PHP 7 で代入順序が変わってるらしい
- 可変関数
- クロージャは use でキャプチャする
- ジェネレータがある

## クラス
- コンストラクタとデストラクタがある
- メソッドのオーバライド
    - parent::親メソッド()
    - final でオーバライド禁止できる
- interface がある
- abstract もある
- instanceof 演算子
- トレイト
- オブジェクトを foreach にかけられる
- マジックメソッド
- namespace がある
- オートローダ


### マジカルインクリメント

    $i = 'Z';
    print ++$i;  // -> AA
    print ++$i;  // -> AB

    $j = 'T8';
    print ++$j;  // -> T9
    print ++$j;  // -> U0

- なお、マジカルデクリメントはない

## PHP 7.0

- null 合体演算子 : `$foo = $bar ?? 'default-value';`
- foreach ブロック内での要素追加の挙動が違う
- 引数・戻り値の型宣言ができる
    - PHP5 ではタイプヒンティングと呼ばれていた
    - double や boolean のようなスカラー型のエイリアスは利用できない
    - （double という名前のクラス / インターフェースであるとみなされる）
- 無名クラス

## memo
- for, foreach
  - 値変数の参照渡し（& つけるやつ）

